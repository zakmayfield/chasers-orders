import './globals.css';

import type { Metadata } from 'next';

import { ToastContainer } from 'react-toastify';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { Header } from '@/features/core/header';
import { Nav } from '@/features/core/nav';
import { Footer } from '@/features/core/footer';
import { CoreProvider } from '@/lib/providers/CoreProvider';
import { getAuthSession } from '@/lib/auth/auth.options';
import { quicksand } from '@/shared/utils/ui';
import { Container } from '@/shared/components/ui';

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const session = await getAuthSession();
  const isAuth = !!session?.user;
  return (
    <html lang='en'>
      <CoreProvider>
        <body className={quicksand.className}>
          {isAuth && <Header />}

          {/* Pages Container */}
          <Container
            as='div'
            padding='lg'
            width='xl'
            center={true}
            flex='col'
            border={true}
            className='min-h-screen'
          >
            {isAuth && <Nav />}
            {children}
          </Container>
          <ToastContainer limit={4} autoClose={3000} position='bottom-right' />

          {/* Dev Tools */}
          <ReactQueryDevtools initialIsOpen={false} />

          {isAuth && <Footer />}
        </body>
      </CoreProvider>
    </html>
  );
}
